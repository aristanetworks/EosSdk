
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>event_loop &#8212; Arista EOS SDK 2.22.0 reference</title>
    <link rel="stylesheet" href="_static/eossdk.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/breathe.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="exception" href="exception.html" />
    <link rel="prev" title="eth_phy_intf_impl" href="eth_phy_intf_impl.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="exception.html" title="exception"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="eth_phy_intf_impl.html" title="eth_phy_intf_impl"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Arista EOS SDK 2.22.0 reference</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="event-loop">
<h1><strong>event_loop</strong><a class="headerlink" href="#event-loop" title="Permalink to this headline">¶</a></h1>
<p>Externalized event loop for alternate agent lifecycles.</p>
<p>This module exposes the SDK’s underlying event loop, which enables programs to be written without using the <code class="docutils literal notranslate"><span class="pre">sdk.main_loop()</span></code> infrastructure.</p>
<p>The first way this module can be used is by writing SDK programs as scripts (instead of long-running agents), by grabbing an instance of the loop via <code class="docutils literal notranslate"><span class="pre">sdk.get_event_loop()</span></code>. Then grab any managers your script needs, and then call <code class="docutils literal notranslate"><span class="pre">loop-&gt;wait_for_initialized()</span></code>. At this point all managers are ready for use. To yield to the event loop at any time, call <code class="docutils literal notranslate"><span class="pre">loop-&gt;run()</span></code>, which gives the SDK time to synchronize with Sysdb and the rest of the system. When your script is finished, call <code class="docutils literal notranslate"><span class="pre">loop-&gt;flush()</span></code> to make sure all writes you’ve performed have been committed to Sysdb. For an example, see examples/NexthopGroupModifierScript.cpp.</p>
<p>The other way this can be used is by integrating the event_loop_handler in an external event loop, for example, by integrating into a Thrift loop. To do this, the SDK exposes various file descriptors that should be watched by calling into a <code class="docutils literal notranslate"><span class="pre">event_loop_handler</span></code> that your program should subclass. For an example, see examples/Thrift[Client|Server].cpp’s interaction with the <code class="docutils literal notranslate"><span class="pre">libevent_loop</span></code> defined in <code class="docutils literal notranslate"><span class="pre">libevent.h</span></code>. </p>
<dl class="namespace">
<dt>
<span class="target" id="eossdknamespaceeos"></span><em>namespace</em> <code class="descname">eos</code></dt>
<dd><dl class="class">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler"></span><em>class</em> <code class="descname">event_loop_handler</code></dt>
<dd><em>#include &lt;event_loop.h&gt;</em><p>Adapter to integrate the EOS event loop with an external event loop. Subclass this class to be able to handle the file descriptors and timers that the EOS code needs to dispatch to your event loop implementation.</p>
<p>When you provide your implementation of <a class="reference internal" href="#eossdkclasseos_1_1event__loop__handler"><span class="std std-ref">event_loop_handler</span></a> to the <a class="reference internal" href="#eossdkclasseos_1_1event__loop"><span class="std std-ref">event_loop</span></a>, EOS code will start calling the watch_* methods to (un)register its interest in various file descriptors, so that you can hook them up into your event loop implementation. When those file descriptors become ready, you must call the corresponding on_*() method in a timely fashion for the EOS code to run.</p>
<p>The on_*() methods are all non-blocking methods. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1ac6b8d910df508c510af1b66ed3dcfdcf"></span>virtual <code class="descname">~event_loop_handler</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1a1b55ea61199e01cd01bbc00cee364838"></span>void <code class="descname">on_readable</code><span class="sig-paren">(</span>int <em>fd</em><span class="sig-paren">)</span></dt>
<dd><p>Notifies the EOS event loop that the file descriptor is readable. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1abdd018ad544b7b3a8b76d46a67511ab7"></span>void <code class="descname">on_writable</code><span class="sig-paren">(</span>int <em>fd</em><span class="sig-paren">)</span></dt>
<dd><p>Notifies the EOS event loop that the file descriptor is writable. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1aba2b966957fbac9c7268f6a2643340ef"></span>void <code class="descname">on_exception</code><span class="sig-paren">(</span>int <em>fd</em><span class="sig-paren">)</span></dt>
<dd><p>Notifies the EOS event loop that the file descriptor has exceptions. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1af9bd4b19989a9c8c64a6b0c0f9348bdc"></span>void <code class="descname">on_timeout</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Notifies the EOS event loop that its next timer has expired. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1aa347916f6c74320b706c9b46e12dc3eb"></span>virtual void <code class="descname">watch_readable</code><span class="sig-paren">(</span>int <em>fd</em>, bool <em>interested</em><span class="sig-paren">)</span> = 0</dt>
<dd><p>Called by EOS to (un)register its interest in a fd being readable. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1a7be327e9cb34b9acbce5a0696206f360"></span>virtual void <code class="descname">watch_writable</code><span class="sig-paren">(</span>int <em>fd</em>, bool <em>interested</em><span class="sig-paren">)</span> = 0</dt>
<dd><p>Called by EOS to (un)register its interest in a fd being writable. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1aabc4689e15506c0c73f711b4f5e2c668"></span>virtual void <code class="descname">watch_exception</code><span class="sig-paren">(</span>int <em>fd</em>, bool <em>interested</em><span class="sig-paren">)</span> = 0</dt>
<dd><p>Called by EOS to (un)register its interest in a fd having exceptions. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop__handler_1a4a49df180a2c9a4e575eda56f962b6e2"></span>virtual void <code class="descname">timeout_time_is</code><span class="sig-paren">(</span>struct timeval <em>deadline</em><span class="sig-paren">)</span> = 0</dt>
<dd><p>Called to register when is the next timeout that EOS code must handle. The deadline passed in argument is relative to now (so for instance if the next timer the EOS code need to handle is in 5 seconds from now, then the deadline will be 5 seconds, not “now + 5s”). If this function is called multiple times, subsequent calls should override the timeout set by previous calls. In other words, there is only one timeout associated with this function, instead of each call creating a new timeout. </p>
</dd></dl>

</div>
</dd></dl>

<dl class="class">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop"></span><em>class</em> <code class="descname">event_loop</code></dt>
<dd><em>#include &lt;event_loop.h&gt;</em><p>The EOS event loop.</p>
<p>This class represents the event loop that is built into EOS code. It can be used to run this loop on demand, or to integrate this event loop with an external event loop, such as that provided by libevent or other third-party code. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1aadaa7396af242b0159b6750c19d05bd3"></span><code class="descname">~event_loop</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1afe5cbacd28356b9a9a51582427d57082"></span>void <code class="descname">wait_for_initialized</code><span class="sig-paren">(</span><span class="sig-paren">)</span> const</dt>
<dd><p>Wait for all managers to be initialized. Generally called right after creating the <a class="reference internal" href="#eossdkclasseos_1_1event__loop"><span class="std std-ref">event_loop</span></a>, as an alternative to creating an <a class="reference internal" href="agent.html#eossdkclasseos_1_1agent__handler"><span class="std std-ref">agent_handler</span></a> and then waiting for on_initialized to be called.</p>
<p>This method is a blocking method. It may block for any amount of time that is necessary to wait for the initial state sync from Sysdb. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1a5cedf15275eb317271a2ad98c407c312"></span>void <code class="descname">run</code><span class="sig-paren">(</span>seconds_t <em>duration</em> = 0<span class="sig-paren">)</span> const</dt>
<dd><p>Run the event loop for <code class="docutils literal notranslate"><span class="pre">duration</span></code> seconds. If no duration is specified, all pending events will be executed and control will be returned to the caller. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1a6a3985b353bf9b22143bebc5c5cf1c17"></span>void <code class="descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span> const</dt>
<dd><p>Drain the event loop of all outgoing writes.</p>
<p>This function should be used in conjunction with EOS SDK scripts, and should be called before your agent exits. This ensures that all writes your script has performed will have made it to Sysdb. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1a52dfe898951eba7bcf85b925a92af2a2"></span>void <code class="descname">external_loop_is</code><span class="sig-paren">(</span><a class="reference internal" href="#eossdkclasseos_1_1event__loop__handler"><span class="std std-ref">event_loop_handler</span></a> * <em>loop</em><span class="sig-paren">)</span></dt>
<dd><p>Registers an external event loop to use instead of EOS’s.</p>
<p>Upon calling this function, the EOS code will start registering its file descriptors and its next timeout with the given handler, and will start expecting that an external event loop will deliver events to the handler in a timely fashion.</p>
<p>If <a class="reference internal" href="#eossdkclasseos_1_1event__loop_1afe5cbacd28356b9a9a51582427d57082"><span class="std std-ref">wait_for_initialized()</span></a> hasn’t been called already, this method is a blocking method. It may block for any amount of time that is necessary to wait for the initial state sync from Sysdb. </p>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Private Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1ad51b8071c626a12583fd278406d511e4"></span><code class="descname">event_loop</code><span class="sig-paren">(</span>mount_mgr *<span class="sig-paren">)</span></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Private Members</p>
<dl class="variable">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1a15859511bd2faaa6498414bb9f8be202"></span><code class="descname">event_loop</code></dt>
<dd></dd></dl>

<dl class="variable">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1a0d957f5b54b823e07d908e27b6c07480"></span>mount_mgr * <code class="descname">mount_mgr_</code></dt>
<dd></dd></dl>

<dl class="variable">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1a0965adc86613c3230b700547fd8db276"></span><a class="reference internal" href="#eossdkclasseos_1_1event__loop__handler"><span class="std std-ref">event_loop_handler</span></a> * <code class="descname">loop_</code></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Friends</p>
<dl class="friend">
<dt>
<span class="target" id="eossdkclasseos_1_1event__loop_1aa92709df4b208445a6de98696b83abeb"></span>friend class <code class="descname">sdk</code></dt>
<dd></dd></dl>

</div>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="eth_phy_intf_impl.html"
                        title="previous chapter"><strong>eth_phy_intf_impl</strong></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="exception.html"
                        title="next chapter"><strong>exception</strong></a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="exception.html" title="exception"
             >next</a> |</li>
        <li class="right" >
          <a href="eth_phy_intf_impl.html" title="eth_phy_intf_impl"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Arista EOS SDK 2.22.0 reference</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Arista Networks.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>