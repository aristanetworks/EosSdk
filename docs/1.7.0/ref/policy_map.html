
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>policy_map &mdash; Arista EOS SDK 1.7.0 reference</title>
    
    <link rel="stylesheet" href="_static/eossdk.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Arista EOS SDK 1.7.0 reference" href="index.html" />
    <link rel="next" title="sdk" href="sdk.html" />
    <link rel="prev" title="panic" href="panic.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sdk.html" title="sdk"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="panic.html" title="panic"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Arista EOS SDK 1.7.0 reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="policy-map">
<h1><strong>policy_map</strong><a class="headerlink" href="#policy-map" title="Permalink to this headline">¶</a></h1>
<p>Policy map manipulation.</p>
<p>This module permits the manipulation of policy maps used in the creation of service policies that can be applied to one or more types of hardware features, beginning with Policy Based Routing (PBR).</p>
<p>Policy maps for PBR (policy based routing) can match rules of either an IPv4 access list (including both source, destination addresses and all normal ACL flags) or any MPLS traffic.</p>
<p>Policy maps are constructed by key (consisting of a name and a feature, only eos::POLICY_FEATURE_PBR is presently supported), and the above rules are configured using the policy_map_mgr. For example, to source route traffic matching the existing ACL &#8220;netblock-fe&#8221; for a PBR policy named &#8220;src-routing-fe&#8221;, use this code in a handler with access to the policy_map_mgr object as policy_map_mgr() in scope.</p>
<p><pre class="literal-block">
   eos::policy_map_key_t pm_key(&quot;src-routing-fe&quot;, eos::POLICY_FEATURE_PBR);
   eos::acl_key_t acl_key(&quot;netblock-fe&quot;, eos::ACL_TYPE_IPV4);
   eos::class_map_t cm(pm_key);
   eos::class_map_rule_t cm_rule(acl_key);
   eos::policy_map_t pm(pm_key);
   eos::policy_map_rule_t pm_rule(pm_key);
   eos::policy_map_action_t action(eos::POLICY_ACTION_NEXTHOP_GROUP);
   action.nexthop_group_name_is(&quot;nhg-fe&quot;);
   pm_rule.action_set(action);
   cm.rule_set(1, cm_rule);
   pm.rule_set(1, pm_rule);
   policy_map_mgr()-&gt;policy_map_is(pm);
   // Apply to Ethernet3/1 (PBR policies are always applied ACL_IN (inbound).
   policy_map_mgr()-&gt;policy_map_apply(pm_key, eos::intf_id_t(&quot;Ethernet3/1&quot;),
                                      eos::ACL_IN, true);
</pre>
</p>
<p>To instead program that same policy matching MPLS traffic instead of an IPv4 ACL, use the following pattern, noting that we explicitly supply a new class map key referring to the special eos::CLASS_MAP_MPLS_ANY name and skip binding the ACL to the class map entirely:</p>
<p><pre class="literal-block">
   eos::policy_map_key_t pm_key(&quot;src-routing-fe&quot;, eos::POLICY_FEATURE_PBR);
   eos::class_map_key_t cm_key(eos::CLASS_MAP_MPLS_ANY, eos::POLICY_FEATURE_PBR);
   eos::class_map_t cm(cm_key);
   eos::policy_map_rule_t pm_rule(cm_key);
   eos::policy_map_action_t action(eos::POLICY_ACTION_NEXTHOP_GROUP);
   action.nexthop_group_name_is(&quot;nhg-fe&quot;);
   pm_rule.action_set(action);
   cm.rule_set(1, cm_rule);
   pm.rule_set(1, pm_rule);
   policy_map_mgr()-&gt;policy_map_is(pm);
   // Finally, apply the policy as before
</pre>
</p>
<p>A valid policy map may have either:</p>
<p>1. One or more rules matching class maps matching one or more IPv4 ACLs. 2. A single policy map rule matching eos::CLASS_MAP_MPLS_ANY class, which itself may have only a single action</p>
<p>Using both &#8220;IP ACL&#8221; and &#8220;MPLS any&#8221; modes in the same policy map is not supported, and a <a class="reference internal" href="exception.html#eossdkclasseos_1_1configuration__error"><em>eos::configuration_error</em></a> will be thrown by the policy map when attempting to set both rules, or attempting to set more than one eos::CLASS_MAP_MPLS_ANY class map match rule per policy map. </p>
<dl class="struct">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__action__t_01_4"></span>template &lt;&gt;</dt>
<dt>
<em>struct</em> <tt class="descname">policy_map_action_t &gt;</tt></dt>
<dd><div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__action__t_01_4_1aa5f5719f16b8da5901b26de7117cf22c"></span>size_t <tt class="descname">operator()</tt><big>(</big>eos::policy_map_action_t const &amp;<big>)</big> const</dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__key__t_01_4"></span>template &lt;&gt;</dt>
<dt>
<em>struct</em> <tt class="descname">policy_map_key_t &gt;</tt></dt>
<dd><div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__key__t_01_4_1a1a00bc1beb13845f0cacc2e9eff0ae20"></span>size_t <tt class="descname">operator()</tt><big>(</big>eos::policy_map_key_t const &amp;<big>)</big> const</dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="namespace">
<dt>
<span class="target" id="eossdknamespaceeos"></span><em>namespace</em> <tt class="descname">eos</tt></dt>
<dd><dl class="class">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__iter__t"></span><em>class</em> <tt class="descname">policy_map_iter_t</tt></dt>
<dd><em>#include &lt;policy_map.h&gt;</em><p>An iterator providing forwards only iteration over collections of policy maps. </p>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Private Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__iter__t_1a4945d8b15fdaacbf15f80422f57a9d8d"></span><tt class="descname">policy_map_iter_t</tt><big>(</big>policy_map_iter_impl * <em>const</em><big>)</big></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Friends</p>
<dl class="friend">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__iter__t_1a1bd9d39d52119ffb6132dd74dc169397"></span>friend class <tt class="descname">policy_map_iter_impl</tt></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="class">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler"></span><em>class</em> <tt class="descname">policy_map_handler</tt></dt>
<dd><em>#include &lt;policy_map.h&gt;</em><p>Event handler for policy feature specific events.</p>
<p>Callbacks about failures to program policy features into hardware are reported via this handler. </p>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1a5f0a7bae3884c8fdd426766b76948b46"></span><tt class="descname">policy_map_handler</tt><big>(</big><a class="reference internal" href="#eossdkclasseos_1_1policy__map__mgr"><em>policy_map_mgr</em></a> *<big>)</big></dt>
<dd><p>Constructs a policy map handler for the supplied policy hardware feature. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1a854075b54d5a0310d32c4c6f37c6336c"></span><a class="reference internal" href="#eossdkclasseos_1_1policy__map__mgr"><em>policy_map_mgr</em></a> * <tt class="descname">get_policy_map_mgr</tt><big>(</big><big>)</big> const</dt>
<dd><p>Returns a pointer to the policy map manager for use in a derived handler. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1aab69ac7d64862286e230a1363ad8ea53"></span>void <tt class="descname">watch_policy_map</tt><big>(</big>policy_map_key_t const &amp; <em>key</em>, bool <em>interest</em><big>)</big></dt>
<dd><p>Registers to receive updates on changes to this policy feature.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last">
<li><tt class="first docutils literal"><span class="pre">key</span></tt> - <p>The policy feature to receive notifications for </p>
</li>
<li><tt class="first docutils literal"><span class="pre">watch</span></tt> - <p>Receives notifications if and only if true. </p>
</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1aa3c1498e8a1c1fa00779ff1b0ee7b5e9"></span>virtual void <tt class="descname">on_policy_map_sync</tt><big>(</big>policy_map_key_t const &amp;<big>)</big></dt>
<dd><p>Callback fired upon successful policy map application.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last">
<li><tt class="first docutils literal"><span class="pre">policy_map_key_t</span></tt> - <p>The key identifying the updated policy map. </p>
</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1a5e57c05780ffc843fdab5d8aec227466"></span>virtual void <tt class="descname">on_policy_map_sync_fail</tt><big>(</big>policy_map_key_t const &amp;, std::string const &amp; <em>message</em><big>)</big></dt>
<dd><p>Callback fired when policy map commit or apply operations failed.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last">
<li><tt class="first docutils literal"><span class="pre">policy_map_key_t</span></tt> - <p>The policy map which failed to update. </p>
</li>
<li><tt class="first docutils literal"><span class="pre">message</span></tt> - <p>An error message which may be the empty string. </p>
</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Protected Attributes</p>
<dl class="variable">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1a1bfe54436bd50cfd89a11bc77a37385c"></span><a class="reference internal" href="#eossdkclasseos_1_1policy__map__mgr"><em>policy_map_mgr</em></a> * <tt class="descname">policy_map_mgr_</tt></dt>
<dd></dd></dl>

<dl class="variable">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__handler_1a405d054adc374ab6a474a20e93ae7dcb"></span>policy_feature_t <tt class="descname">feature_</tt></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="class">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr"></span><em>class</em> <tt class="descname">policy_map_mgr</tt></dt>
<dd><em>#include &lt;policy_map.h&gt;</em><p>EOS policy map manager.</p>
<p>The policy manager provides access to policy-map management, as well as policy map application to interfaces. </p>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1a171bfdc7e6791672ac28baa834787450"></span>virtual <tt class="descname">~policy_map_mgr</tt><big>(</big><big>)</big></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1a3772ba4a70c70d44835972f483cd2a2b"></span>virtual void <tt class="descname">resync_init</tt><big>(</big><big>)</big> = 0</dt>
<dd><p>Resync </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1aea8826f5df37ce2efaf3daa93294b38d"></span>virtual void <tt class="descname">resync_complete</tt><big>(</big><big>)</big> = 0</dt>
<dd><p>Completes any underway resync operation. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1aa7646ca09491085c2c3e1687d18059c5"></span>virtual bool <tt class="descname">exists</tt><big>(</big>policy_map_key_t const &amp; <em>key</em><big>)</big> const = 0</dt>
<dd><p>Returns true if and only if the provided policy map key is configured. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1a9c80582845de2840cb4f26fd8efc95c9"></span>virtual policy_map_t <tt class="descname">policy_map</tt><big>(</big>policy_map_key_t const &amp; <em>key</em><big>)</big> const = 0</dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1ab8f7005b3349fcc091f03e597750c18f"></span>virtual void <tt class="descname">policy_map_is</tt><big>(</big>policy_map_t const &amp; <em>policy_map</em><big>)</big> = 0</dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1afaeda0dfc6b581fb0d2a17adcb7e1331"></span>virtual void <tt class="descname">policy_map_del</tt><big>(</big>policy_map_key_t const &amp; <em>key</em><big>)</big> = 0</dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1a0731955f7931a911d1df3f0f8c9fb41e"></span>virtual <a class="reference internal" href="#eossdkclasseos_1_1policy__map__iter__t"><em>policy_map_iter_t</em></a> <tt class="descname">policy_map_iter</tt><big>(</big>policy_feature_t<big>)</big> const = 0</dt>
<dd><p>Provides iteration over the configured policy maps for a feature. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1ae52cb621483585bfbc993bd893d1f223"></span>virtual void <tt class="descname">policy_map_apply</tt><big>(</big>policy_map_key_t const &amp;, intf_id_t, acl_direction_t, bool <em>apply</em><big>)</big> = 0</dt>
<dd><p>Applies or unapplies the policy map to an interface in a direction. </p>
</dd></dl>

</div>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Protected Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1aad10ce3748c28df573657d235dbfe4ad"></span><tt class="descname">policy_map_mgr</tt><big>(</big><big>)</big></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Private Members</p>
<dl class="variable">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1a0845eb3c70d3bf2dfd7c0c58f748412c"></span><tt class="descname">policy_map_mgr</tt></dt>
<dd></dd></dl>

</div>
<div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Friends</p>
<dl class="friend">
<dt>
<span class="target" id="eossdkclasseos_1_1policy__map__mgr_1ae5d3fcb310a8862b41820e1f6e23174a"></span>friend class <tt class="descname">policy_map_handler</tt></dt>
<dd></dd></dl>

</div>
</dd></dl>

</dd></dl>

<dl class="namespace">
<dt>
<span class="target" id="eossdknamespacestd"></span><em>namespace</em> <tt class="descname">std</tt></dt>
<dd><p>STL namespace. </p>
<dl class="struct">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__action__t_01_4"></span>template &lt;&gt;</dt>
<dt>
<em>struct</em> <tt class="descname">policy_map_action_t &gt;</tt></dt>
<dd><div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__action__t_01_4_1aa5f5719f16b8da5901b26de7117cf22c"></span>size_t <tt class="descname">operator()</tt><big>(</big>eos::policy_map_action_t const &amp;<big>)</big> const</dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__key__t_01_4"></span>template &lt;&gt;</dt>
<dt>
<em>struct</em> <tt class="descname">policy_map_key_t &gt;</tt></dt>
<dd><div class="breathe-sectiondef container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt>
<span class="target" id="eossdkstructstd_1_1hash_3_01eos_1_1policy__map__key__t_01_4_1a1a00bc1beb13845f0cacc2e9eff0ae20"></span>size_t <tt class="descname">operator()</tt><big>(</big>eos::policy_map_key_t const &amp;<big>)</big> const</dt>
<dd></dd></dl>

</div>
</dd></dl>

</dd></dl>

<div class="section" id="type-definitions-in-policy-map">
<h2>Type definitions in <strong>policy_map</strong><a class="headerlink" href="#type-definitions-in-policy-map" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">doxygenfile: Found multiple matches for file &#8220;eos/types/policy_map.h </p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><strong>policy_map</strong></a><ul>
<li><a class="reference internal" href="#type-definitions-in-policy-map">Type definitions in <strong>policy_map</strong></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="panic.html"
                        title="previous chapter"><strong>panic</strong></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sdk.html"
                        title="next chapter"><strong>sdk</strong></a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sdk.html" title="sdk"
             >next</a> |</li>
        <li class="right" >
          <a href="panic.html" title="panic"
             >previous</a> |</li>
        <li><a href="index.html">Arista EOS SDK 1.7.0 reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Arista Networks.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>